<div ng-controller="MainCtrl as mainCtrl">
  <div ng-include="'nav.html'"></div>

  <div id="wrapper"
       class="toggled"
       ng-controller="DatasetsCtrl as datasetsCtrl">

    <div ng-controller="MetadataCtrl as metadataCtrl">

      <div class="overlay"></div>
      <section style="height: 100%" layout="row" flex="">

        <md-content flex="" layout-padding="">
          <div ng-include="'navProject.html'"></div>

          <div layout="column" layout-fill="" layout-align="top center">
            <div ng-show="mainCtrl.searchReturned !== ''">
              <div id="projectSearchResults">
                <div ng-include="'views/searchResult.html'"></div>
              </div>
            </div>

            <div class="content-wrapper" ng-controller="ProjectCtrl as projectCtrl" ng-show="mainCtrl.searchReturned === ''">
              <h3>
                <div class="col-lg-3" style="margin-top: -17px; margin-left: 13px;">
                  <button class="btn btn-success" ng-click="datasetsCtrl.newDataSetModal()" dropdown-toggle type="button" id="newDataSet" aria-haspopup="true" aria-expanded="true">
                    Create New DataSet
                  </button>
                </div>
                <div class="col-lg-6" style="max-width: 550px; " >
                  <!--                  <div class="ibox float-e-margins">
                                      <div class="ibox-content" style="padding-left:0px; padding-right:0px;">
                                        <div class="file-manager">-->
                  <!--style="margin: 0px; font-weight: bold; color: #2e353d;"-->
                  Filter: 
                  <a ng-click="datasetsCtrl.shared = undefined; datasetsCtrl.status = undefined; datasetsCtrl.isPublic = undefined;" class="file-control active">All</a>
                  <a ng-click="datasetsCtrl.shared = true; datasetsCtrl.status = true; datasetsCtrl.isPublic = false" class="file-control">Shared</a>
                  <a ng-click="datasetsCtrl.shared = false; datasetsCtrl.status = true; datasetsCtrl.isPublic = false" class="file-control">Exclusive</a>
                  <a ng-click="datasetsCtrl.shared = true; datasetsCtrl.status = false; datasetsCtrl.isPublic = false" class="file-control">Pending</a>
                  <a ng-click="datasetsCtrl.shared = false; datasetsCtrl.status = false; datasetsCtrl.isPublic = true" class="file-control">Public</a>
                </div>
                <div class="col-md-1 col-lg-1 pull-right" style="margin-top: -18px;">
                  <hamburger-toggle state="datasetsCtrl.tgState" class="hamburger-toggle" ng-click="datasetsCtrl.deselect()">
                  </hamburger-toggle>
                </div>
              </h3>


              <div class="ds-content col-lg-12" ng-class="{'sidenav-open': datasetsCtrl.tgState}" style="margin-top: 5px;">
                <div class="row row-no-margin-left" style="margin-top: 15px;">

                  <div class="col-lg-12">


                    <div ng-repeat="dataset in datasetsCtrl.files| filter:{shared: datasetsCtrl.shared, status: datasetsCtrl.status, isPublic: datasetsCtrl.isPublic} | orderBy: 'name'">
                      <div ng-dblclick="projectCtrl.browseDataset(dataset)"
                           ng-click="datasetsCtrl.select($index, dataset); metadataCtrl.setMetadataTemplate(dataset); datasetsCtrl.openMetadata();"
                           ng-init="(iscollapsed$index) = true"
                           class="file-box"
                           context-menu
                           data-target="menu-{{ $index}}">
                        <div class="file" ng-class="{'greyed' : datasetsCtrl.selected === $index}">
                          <a>
                            <span class="publicDS" ng-class="{'glyphicon glyphicon-globe': dataset.publicDS === true}"></span>
                            <span class="corner"></span>
                            <div class="icon">
                              <i class="glyphicon" ng-class="{'glyphicon-folder-close': datasetsCtrl.selected === $index, 'glyphicon-folder-open' : datasetsCtrl.selected !== $index}"></i>
                            </div>
                            <div class="file-name">
                              {{dataset.name}}
                              <br/>
                              <small><b>Owner:</b> {{dataset.owner}}</small>
                            </div>
                          </a>
                        </div>
                      </div>  
<!--                              <div ng-init="(iscollapsed$index) = true"
                                   class="file-box"
                                   context-menu
                                   data-target="menu-{{ $index}}">
                                <div  class="file">
                                  <div ng-click="projectCtrl.browseDataset(dataset)">
                                    <a>
                                      <span class="corner"></span>
                                      <div class="icon">
                                        <i class="glyphicon glyphicon-folder-open"></i>
                                      </div>
                                    </a>
                                  </div>
                                  <div class="file-name">
                                    {{dataset.name}}
                                    <br/>
                                    <small><b>Owner: </b> {{dataset.owner}}</small>
                                    <br/>
                                    <button
                                      style="font-size:15px;height:28px;color:white;padding-top: 3px; margin-left: 20px; margin-top: -40px;"
                                      ng-click="datasetsCtrl.select($index, dataset); metadataCtrl.setMetadataTemplate(dataset)"
                                      class="btn btn-info">
                                      <i class="fa fa-search"></i>
                                    </button>
                                  </div>
                                </div>
                              </div>-->
                      <div class="dropdown position-fixed" id="menu-{{$index}}">
                        <ul class="dropdown-menu dropdown-amore">
                          <li ng-show="projectCtrl.role === 'Data owner'">
                            <a class="pointer"
                               role="menuitem"
                               tabindex="1"
                               ng-click="datasetsCtrl.deleteFile(dataset.name)">
                              <span><i class="fa fa-trash"></i>
                                Remove DataSet</span>
                            </a>
                          </li>
                          <li ng-show="projectCtrl.role === 'Data owner'">
                            <a class="pointer"
                               role="menuitem"
                               tabindex="2"
                               ng-click="datasetsCtrl.share(dataset.name)">
                              <span><i class="fa fa-share"></i>
                                Share DataSet</span>
                            </a>
                          </li>
                          <li class="divider"></li>
                         <li>
                            <a class="pointer"
                               role="menuitem"
                               tabindex="3"
                               ng-click="metadataCtrl.attachTemplate(dataset); $event.stopPropagation();">
                              <span><i class="fa fa-upload"></i>
                                Add metadata</span>
                            </a>
                          </li>
                          <li>
                            <a class="pointer"
                               role="menuitem"
                               tabindex="4"
                               ng-click="metadataCtrl.detachTemplate(dataset); $event.stopPropagation();">
                              <span><i class="fa fa-download"></i>
                                Remove metadata</span>
                            </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                            <a class="pointer"
                               role="menuitem"
                               tabindex="5"
                               ng-click="panel.highlight = true; datasetsCtrl.compress(dataset); $event.stopPropagation();">
                              <span><i class="fa fa-file-archive-o"></i>
                                Compress</span>
                            </a>
                          </li>
                          <li ng-show="projectCtrl.role === 'Data owner'">
                            <a class="pointer"
                               role="menuitem"
                               tabindex="6"
                               ng-click="datasetsCtrl.makePublic(dataset.id); $event.stopPropagation();">
                              <span><i class="fa fa-share-alt"></i>
                                Make Public</span>
                            </a>
                          </li>
                        </ul>
                      </div>
                    </div> <!-- end repeat -->

                    <div ng-init="(iscollapsed$index) = true; datasetsCtrl.tgState = true;"
                         ng-show="datasetsCtrl.files.length < 20"
                         class="file-box"
                         context-menu
                         data-target="menu-{{ $index}}">
                      <div  class="file" ng-click="datasetsCtrl.newDataSetModal()">
                        <div class="icon">
                          <i class="glyphicon glyphicon-plus"></i>
                        </div>
                        <div class="file-name ng-binding">
                          <div style="text-align: center; color: green;">
                            Create New DataSet
                          </div>
                          <div class="row"><br></div>
                        </div>
                      </div>
                    </div>                  
                  </div>
                </div>
              </div>
            </div> <!--content wrapper -->
          </div>
          <div flex=""></div>
        </md-content>

        <!--<div class="col-lg-4" style="border-left: 1px dashed lightgrey; padding-left: 0px;">-->
        <div class="ds-sidenav" ng-class="{open: datasetsCtrl.tgState}">
          <div class="ibox float-e-margins" style="margin-bottom: -25px; height: 95%;">
            <div class="file-manager">
              <div>
                <md-content class="md-padding" style="padding-top: 0px; min-width: 300px;">
                  <md-tabs md-dynamic-height md-border-bottom>
                    <md-tab label="Details">
                      <div ng-show="datasetsCtrl.selected === null || datasetsCtrl.selected < 0">
                        <br>
                        <div class="file" style="text-align: center;">
                          <div class="icon">
                            <i class="glyphicon glyphicon-folder-open"></i>
                          </div>  
                          Select a DataSet to view its details.
                        </div>           
                      </div>
                      <md-content>
                        <table id="mytable1" ng-show="datasetsCtrl.selected !== undefined && datasetsCtrl.selected > -1" class="table table-bordred table-striped" style="margin-top: 16px;">

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Description</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail
                                                  .description}}</td>
                          </tr>

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Last modified</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.modification| date:'short'}}</td>
                          </tr>

                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Owner</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.owner}}</td>
                          </tr>
                          <tr style="background-color: #fafafa">
                            <td style="color:lightgrey;">Permission</td>
                            <td style="color: grey;">{{datasetsCtrl.fileDetail.permission}}</td>
                          </tr>
                        </table>

                      </md-content>
                    </md-tab>
                    <md-tab label="Activity">
                      <md-content class="md-padding" style="padding-left: 20px;padding-right: 20px;">

                        <div class="row">
                          <span
                            style="color: #444;font-size: 11px; margin-bottom: 10px;padding: 16px 6px 6px;text-transform: uppercase;">
                            LAST WEEK
                          </span>

                          <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                         style="border-radius: 3px; margin-top:10px;">
                            <div class="col-md-2" style="margin-top: -45px;">
                              <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                   src="https://gravatar.com/avatar/4b43f0e86b038f246887dde7f399a5a3?d=mm">
                            </div>
                            <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                              <b>You</b> uploaded an item
                              </br>
                              <span style="color:#444; font-size: 11px;">Apr 30</span>

                              <p style="margin-top: 20px; color:#444;">
                                SICSEngineering.pdf
                              </p>
                            </div>
                          </md-whiteframe>

                          <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                         style="border-radius: 3px; margin-top:20px; margin-bottom: 20px;">
                            <div class="col-md-2" style="margin-top: -45px;">
                              <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                   src="https://gravatar.com/avatar/4b43f0e86b038f246887dde7f399a5a3?d=mm">
                            </div>
                            <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                              <b>André</b> uploaded an item
                              </br>
                              <span style="color:#444; font-size: 11px;">Apr 11</span>

                              <p style="margin-top: 20px; color:#444;">
                                AndreSecretFile.rsa
                              </p>
                            </div>
                          </md-whiteframe>

                          <span
                            style="color: #444;font-size: 11px; margin-bottom: 10px;padding: 16px 6px 6px;text-transform: uppercase;">
                            EARLIER THIS MONTH
                          </span>


                          <md-whiteframe class="md-whiteframe-z1" layout layout-align="center center"
                                         style="border-radius: 3px; margin-top:10px;">
                            <div class="col-md-2" style="margin-top: -45px;">
                              <img class="profile-image img-circle" style="height: 42px; border: 1px solid lightgrey;"
                                   src="https://gravatar.com/avatar/f7b87f83afcba880c6300e1e4e4a8790?d=mm">
                            </div>
                            <div class="col-md-10" style="margin-top: 12px;padding-left:20px;">
                              <b>Ermias</b> uploaded an item
                              </br>
                              <span style="color:#444; font-size: 11px;">Apr 07</span>

                              <p style="margin-top: 20px; color:#444;">
                                happy_birthday.cake
                              </p>
                            </div>
                          </md-whiteframe>
                        </div>
                      </md-content>
                    </md-tab>

                  </md-tabs>
                </md-content>
              </div>
            </div>
          </div>
        </div>

      </section>
    </div>
  </div>
</div>
